;; Peripheral definitions â€” constrained capability envelopes.
;;
;; Each peripheral specifies the tools, scope, entry/exit conditions,
;; and context that an agent operates within. Constraints are structural:
;; agents cannot accidentally exceed scope.
;;
;; Derived from: futon3/docs/peripheral-spec.md
;; Validated against: futon3c.social.shapes/PeripheralSpec

{:peripherals
 {:explore
  {:peripheral/id :explore
   :peripheral/tools #{:read :glob :grep :bash-readonly :web-fetch}
   :peripheral/scope :full-codebase
   :peripheral/entry #{:default :from-reflect}
   :peripheral/exit #{:found-target :ready-to-edit :user-request :hop-reflect}
   :peripheral/context {:session-id :inherit}}

  :edit
  {:peripheral/id :edit
   :peripheral/tools #{:read :edit :write :bash}
   :peripheral/scope {:paths ["src/" "docs/" "scripts/"]}
   :peripheral/entry #{:from-explore :from-test :user-request}
   :peripheral/exit #{:tests-pass :ready-to-commit :blocked :hop-test :hop-reflect}
   :peripheral/context {:session-id :inherit :target-files :from-explore}}

  :test
  {:peripheral/id :test
   :peripheral/tools #{:read :bash-test}
   :peripheral/scope :test-commands-only
   :peripheral/entry #{:from-edit :user-request}
   :peripheral/exit #{:pass :fail :flaky :hop-edit :hop-deploy :hop-reflect}
   :peripheral/context {:session-id :inherit :changed-files :from-edit}}

  :deploy
  {:peripheral/id :deploy
   :peripheral/tools #{:bash-git :bash-deploy}
   :peripheral/scope :git-push-only
   :peripheral/entry #{:from-test :tests-passed}
   :peripheral/exit #{:deployed :blocked :hop-reflect}
   :peripheral/context {:session-id :inherit :commit-message :from-edit}}

  :reflect
  {:peripheral/id :reflect
   :peripheral/tools #{:read :musn-log}
   :peripheral/scope :session-log-only
   :peripheral/entry #{:session-close :user-request :agent-request :from-any}
   :peripheral/exit #{:par-generated}
   :peripheral/context {:session-id :inherit :session-log :fetch-from-musn}}

  :proof
  {:peripheral/id :proof
   :peripheral/tools #{:read :glob :grep :write :bash :bash-readonly
                       :proof-load :proof-save
                       :ledger-query :ledger-upsert
                       :dag-check :dag-impact
                       :canonical-get :canonical-update
                       :cycle-begin :cycle-advance :cycle-get :cycle-list
                       :failed-route-add :status-validate :gate-check}
   :peripheral/scope :full-codebase
   :peripheral/entry #{:from-explore :user-request :from-any}
   :peripheral/exit #{:cycle-completed :blocked :hop-reflect :hop-explore :user-request}
   :peripheral/context {:session-id :inherit :problem-id :from-explore}}

  :discipline
  {:peripheral/id :discipline
   :peripheral/tools #{:psr-search :psr-select :pur-update :pur-mark-pivot :par-punctuate}
   :peripheral/scope :discipline-records
   :peripheral/entry #{:from-any :from-reflect :user-request}
   :peripheral/exit #{:par-generated :hop-reflect :user-request}
   :peripheral/context {:session-id :inherit :pattern-id :inherit}}

  :chat
  {:peripheral/id :chat
   :peripheral/tools #{}
   :peripheral/scope :irc-rooms
   :peripheral/entry #{:default :from-any :user-request}
   :peripheral/exit #{:user-request :hop-explore :hop-edit :hop-reflect}
   :peripheral/context {:session-id :inherit :channel :from-irc}}

  :mission
  {:peripheral/id :mission
   :peripheral/tools #{:read :glob :grep :write :bash :bash-readonly
                       :mission-load :mission-save
                       :obligation-query :obligation-upsert
                       :dag-check :dag-impact
                       :mission-spec-get :mission-spec-update
                       :cycle-begin :cycle-advance :cycle-get :cycle-list
                       :failed-approach-add :status-validate :gate-check
                       :corpus-check :evidence-query}
   :peripheral/scope :full-codebase
   :peripheral/entry #{:from-explore :user-request :from-any}
   :peripheral/exit #{:cycle-completed :blocked :hop-reflect :hop-explore :user-request}
   :peripheral/context {:session-id :inherit :mission-id :from-explore}}

  :alfworld
  {:peripheral/id :alfworld
   :peripheral/tools #{:alfworld-action :bell :whistle}
   :peripheral/scope :alfworld-simulation
   :peripheral/entry #{:default :from-chat :user-request}
   :peripheral/exit #{:won :stuck :user-request :hop-chat :hop-reflect}
   :peripheral/context {:session-id :inherit :alfworld-state :resumable}
   :peripheral/config {:alfworld-server "http://localhost:3456"}}

  :mission-control
  {:peripheral/id :mission-control
   :peripheral/tools #{:read :glob :grep :bash-readonly
                       :mc-inventory :mc-devmaps :mc-coverage
                       :mc-mana :mc-review :mc-bulletin
                       :tickle-scan :tickle-page :tickle-cycle}
   :peripheral/scope :full-codebase
   :peripheral/entry #{:from-any :user-request}
   :peripheral/exit #{:review-complete :hop-reflect :hop-explore :user-request}
   :peripheral/context {:session-id :inherit}}}}
