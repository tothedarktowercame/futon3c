#!/usr/bin/env bash
set -euo pipefail

# Laptop profile for futon3c dev.
# Usage:
#   FUTON3C_SELF_URL=http://<laptop-host>:47070 \
#   FUTON3C_LINODE_URL=http://<linode-host>:7070 \
#   ./scripts/dev-laptop-env
#
# Notes:
# - FUTON3C_LINODE_URL is optional; when set, it is used as FUTON3C_PEERS
#   unless FUTON3C_PEERS is already provided.

export FUTON3C_ROLE="${FUTON3C_ROLE:-laptop}"
export FUTON3C_BIND_HOST="${FUTON3C_BIND_HOST:-127.0.0.1}"
export FUTON3C_PORT="${FUTON3C_PORT:-47070}"
export FUTON3C_IRC_PORT="${FUTON3C_IRC_PORT:-0}"

if [[ -n "${FUTON3C_LINODE_URL:-}" && -z "${FUTON3C_PEERS:-}" ]]; then
  export FUTON3C_PEERS="${FUTON3C_LINODE_URL}"
fi

if [[ -z "${FUTON3C_SELF_URL:-}" ]]; then
  echo "[dev-laptop-env] FUTON3C_SELF_URL is not set; federation callbacks from peers will be disabled."
fi

exec make dev "$@"
